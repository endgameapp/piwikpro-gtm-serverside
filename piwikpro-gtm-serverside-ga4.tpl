___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Piwik PRO server-side (GA4-based)",
  "categories": [
    "ANALYTICS"
  ],
  "brand": {
    "id": "github.com_endgameapp",
    "displayName": "EndGameApps",
    "thumbnail": "data:image/png;base64,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Y0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAo5QTFRF///////M//+Z//9m//8z//8A/8z//8zM/8yZ/8xm/8wz/8wA/5n//5nM/5mZ/5lm/5kz/5kA/2b//2bM/2aZ/2Zm/2Yz/2YA/zP//zPM/zOZ/zNm/zMz/zMA/wD//wDM/wCZ/wBm/wAz/wAAzP//zP/MzP+ZzP9mzP8zzP8AzMz/zMzMzMyZzMxmzMwzzMwAzJn/zJnMzJmZzJlmzJkzzJkAzGb/zGbMzGaZzGZmzGYzzGYAzDP/zDPMzDOZzDNmzDMzzDMAzAD/zADMzACZzABmzAAzzAAAmf//mf/Mmf+Zmf9mmf8zmf8Amcz/mczMmcyZmcxmmcwzmcwAmZn/mZnMmZmZmZlmmZkzmZkAmWb/mWbMmWaZmWZmmWYzmWYAmTP/mTPMmTOZmTNmmTMzmTMAmQD/mQDMmQCZmQBmmQAzmQAAZv//Zv/MZv+ZZv9mZv8zZv8AZsz/ZszMZsyZZsxmZswzZswAZpn/ZpnMZpmZZplmZpkzZpkAZmb/ZmbMZmaZZmZmZmYzZmYAZjP/ZjPMZjOZZjNmZjMzZjMAZgD/ZgDMZgCZZgBmZgAzZgAAM///M//MM/+ZM/9mM/8zM/8AM8z/M8zMM8yZM8xmM8wzM8wAM5n/M5nMM5mZM5lmM5kzM5kAM2b/M2bMM2aZM2ZmM2YzM2YAMzP/MzPMMzOZMzNmMzMzMzMAMwD/MwDMMwCZMwBmMwAzMwAAAP//AP/MAP+ZAP9mAP8zAP8AAMz/AMzMAMyZAMxmAMwzAMwAAJn/AJnMAJmZAJlmAJkzAJkAAGb/AGbMAGaZAGZmAGYzAGYAADP/ADPMADOZADNmADMzADMAAAD/AADMAACZAABmAAAzAAAAEBMa////jXqdlgAAANp0Uk5T/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wCDBazeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFw2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4yLWMwMDAgNzkuNTY2ZWJjNWI0LCAyMDIyLzA1LzA5LTA4OjI1OjU1ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjAtMDMtMjVUMTA6MzE6MTMrMDE6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIyLTA4LTI0VDE5OjU5OjU0KzAyOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTA4LTI0VDE5OjU5OjU0KzAyOjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpiMmY2ZTVjMC01Y2NjLTRhMjgtYTRiNS1iM2Y0ODRiMzlmOGUiIHhtcE1NOkRvY3Vt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"
  },
  "description": "Server-side tag template that sends Google Analytics 4 Ecommerce events to Piwik PRO HTTP API. Works best with the GA4 client.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "accountURL",
    "displayName": "Account address",
    "simpleValueType": true,
    "help": "Your account address in Piwik PRO.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "^https://.*"
        ],
        "errorMessage": "The address must start with \"https://\""
      },
      {
        "type": "REGEX",
        "args": [
          ".*\\/$"
        ],
        "errorMessage": "The address must end with a \"/\""
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "siteID",
    "displayName": "Site or app ID",
    "simpleValueType": true,
    "help": "The unique ID for your site or app in Piwik PRO."
  },
  {
    "type": "GROUP",
    "name": "dataCollection",
    "displayName": "Data collection settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "useDefaultEndpoint",
        "checkboxText": "Use default tracking paths",
        "simpleValueType": true,
        "help": "By default, all tracking requests will be sent to the default \"ppms.js\" endpoint. Turn this option off to set your own path.",
        "defaultValue": true
      },
      {
        "type": "TEXT",
        "name": "customEndpoint",
        "displayName": "Custom tracking path",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "useDefaultEndpoint",
            "paramValue": false,
            "type": "EQUALS"
          }
        ],
        "help": "Set your own custom tracking endpoint for all tracking requests."
      },
      {
        "type": "CHECKBOX",
        "name": "anonymousTracking",
        "checkboxText": "Anonymize data",
        "simpleValueType": true,
        "help": "If enabled, you won\u0027t collect personal data like the user\u0027s IP address."
      },
      {
        "type": "CHECKBOX",
        "name": "useDefaultUserID",
        "checkboxText": "Set my own User ID",
        "simpleValueType": true,
        "help": "Allows you to use the application identifier of a visitor instead of a default identifier generated by the analytics. Note: using personal identifiable information (like email address) is not allowed in certain countries.",
      },
      {
        "type": "TEXT",
        "name": "UserID",
        "displayName": "Custom User ID",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "useDefaultUserID",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "setEventMapping",
        "checkboxText": "Custom event mapping",
        "simpleValueType": true,
        "help": "When enabled, you can map additional GA4 events with Piwik PRO custom events."
      },
      {
        "type": "PARAM_TABLE",
        "name": "eventMappings",
        "displayName": "Custom event mapping",
        "paramTableColumns": [
          {
            "param": {
              "type": "TEXT",
              "name": "gaEventName",
              "displayName": "GA4 Event Name *",
              "simpleValueType": true,
              "help": "The name of the event send by Google Analytics 4 client tag.",
              "valueValidators": [
              {
               "type": "NON_EMPTY"
              }
              ]
            },
            "isUnique": true
          },
          {
            "param": {
              "type": "TEXT",
              "name": "ppEventCategory",
              "displayName": "Piwik PRO Event Category *",
              "help": "Most likely this will be the same value as your GA4 Event Name.",
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "TEXT",
              "name": "ppEventAction",
              "displayName": "Piwik PRO Event Action *",
              "help": "The specific action for your Event Category (could also be the GA4 Event Name in some cases).",
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "TEXT",
              "name": "ppEventName",
              "displayName": "Piwik PRO Event Name",
              "help": "The specific name for your Event. Formerly known as Event Label in Google Analytics.",
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "TEXT",
              "name": "ppEventValue",
              "displayName": "Piwik PRO Event Value",
              "help": "This should be a number. It can be used to calculate Event Values.",
              "simpleValueType": true
            },
            "isUnique": false
          }
        ],
        "enablingConditions": [
          {
            "paramName": "setEventMapping",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "newRowButtonText": "Add an event mapping",
        "help": "You can use event mapping to provide Piwik with the right values for Event Category, Event Action, Event Name and Event Value. If the GA4 event is not mapped but still send to Piwik Pro, then it will get listed under Event Category \u0027ga4_events\u0027 with the event name set as Event Action.",
        "newRowTitle": "Add an event mapping"
      },
      {
        "type": "CHECKBOX",
        "name": "sendCustomDimensions",
        "checkboxText": "Send custom dimensions",
        "simpleValueType": true,
        "help": "When enabled, you can send custom dimensions with your requests to Piwik PRO."
      },
      {
        "type": "PARAM_TABLE",
        "name": "customDimensionMappings",
        "displayName": "Custom dimension mapping",
        "paramTableColumns": [
          {
            "param": {
              "type": "TEXT",
              "name": "gaDimensionID",
              "displayName": "GA4 Custom Dimension parameter name",
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "TEXT",
              "name": "ppDimensionID",
              "displayName": "Piwik PRO Analytics Custom Dimension ID",
              "simpleValueType": true
            },
            "isUnique": true
          }
        ],
        "enablingConditions": [
          {
            "paramName": "sendCustomDimensions",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "newRowButtonText": "Add a custom dimension",
        "help": "Specify which custom dimensions you would like to send to Piwik PRO Analytics. Source: the GA4 event parameter name. Piwik Pro dimension ID can be found inside Piwik Pro. You can map the same GA4 parameter to multiple Piwik PRO Analytics custom dimensions.",
        "newRowTitle": "Add a custom dimension"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

// Import necessary server-side tagging APIs
const getClientName = require('getClientName');
const getAllEventData = require('getAllEventData');
const sendHttpGet = require('sendHttpGet');
const encodeUriComponent = require('encodeUriComponent');
const logToConsole = require('logToConsole');
const JSON = require('JSON');
const Math = require('Math');

// Get the name of the tagging client used
const clientName = getClientName();

// Read event data
const eventData = getAllEventData();

// Parse custom dimensions from the dimension event object
// Builds a string with new params for the Piwik PRO tracking request
const parseCustomDimensions = (eventData, dimensionMappings) => {
  let dimensionParams = [];

  // Adds custom dimensions based on the mappings
  dimensionMappings.forEach((mapping) => {
    // Only sends the dimensions from the mapping that are available in the event
    if (typeof eventData[mapping.gaDimensionID] !== "undefined") {
      dimensionParams.push('&dimension' + 
                           mapping.ppDimensionID + 
                           '=' + 
                           encodeUriComponent(eventData[mapping.gaDimensionID]));
    } else {
      logToConsole(
        'Custom dimension (ID: ' + mapping.gaDimensionID + ') was not sent with the event.'
      );
    }
  });

  return dimensionParams.join('');
};

// Calculate total discount for purchases
const parseDiscount = (items) => {
  var totalDiscount = 0;
  items.forEach(item => {
    if (item.hasOwnProperty('discount'))
      totalDiscount += item.discount;
  });
  return totalDiscount;
};

// Reformat GA4 items object
const parseItems = (items) => {
  var parsedItems = [];
  items.forEach(item => {
		let reformattedItem = [];
    reformattedItem.push(item.item_id);
    reformattedItem.push(item.item_name);

    //parse categories
    var categoryArray = [];
    if(item.hasOwnProperty('item_category')) categoryArray.push(item.item_category);
    if(item.hasOwnProperty('item_category_2')) categoryArray.push(item.item_category_2);
    if(item.hasOwnProperty('item_category_3')) categoryArray.push(item.item_category_3);
    if(item.hasOwnProperty('item_category_4')) categoryArray.push(item.item_category_4);
    if(item.hasOwnProperty('item_category_5')) categoryArray.push(item.item_category_5);
    if(categoryArray.length > 0) { reformattedItem.push(categoryArray); } else { reformattedItem.push(null); }

    // price is optional
    if(item.hasOwnProperty('price')) { reformattedItem.push(item.price); } else { reformattedItem.push(null); }
    // quantity is optional
    if(item.hasOwnProperty('quantity')) { reformattedItem.push(item.quantity); } else { reformattedItem.push(1); }
    
    parsedItems.push(reformattedItem);
  });
  return JSON.stringify(parsedItems);
};

// Decide if the event is inside the custom event mappings
const isMappedEvent = (eventName) => {
  let theEventName = eventName;
  if (data.setEventMapping == true) {
        const eventMappings = data.eventMappings;
        eventMappings.forEach((eventmapping) => {
          // Check if event is inside the mapped events table
          if (eventName == eventmapping.gaEventName) {
            theEventName = 'mapped_event';
          } 
        });
  }
  return theEventName;
};

// Build an analytics request for different event types
const buildRequest = (eventData) => {
  const eventType = isMappedEvent(eventData.event_name);
  
  // It's possible to customise the tracking endpoint. The default option is ppms.php
  const requestEndpoint = data.useDefaultEndpoint ? 'ppms.php' : data.customEndpoint;
  
  // Add common tracking request parameters (that won't change regardless of the event type)
  const client_id = eventData.hasOwnProperty('client_id') ? '&uid=' + encodeUriComponent(eventData.client_id) : '';
  const page_location = eventData.hasOwnProperty('page_location') ? '&url=' + encodeUriComponent(eventData.page_location) : '';
  const ip_override = eventData.hasOwnProperty('ip_override') ? '&cip=' + encodeUriComponent(eventData.ip_override) : '';
  const user_agent = eventData.hasOwnProperty('user_agent') ? '&ua=' + encodeUriComponent(eventData.user_agent) : '';
  const screen_resolution = eventData.hasOwnProperty('screen_resolution') ? '&res=' + encodeUriComponent(eventData.screen_resolution) : '';
  const page_referrer = eventData.hasOwnProperty('page_referrer') ? '&urlref=' + encodeUriComponent(eventData.page_referrer) : '';
  const lang = eventData.hasOwnProperty('lang') ? '&lang=' + encodeUriComponent(eventData.lang) : '';
  let requestPath = requestEndpoint + '?' +
        'rec=1' + '&' +
        'idsite=' + encodeUriComponent(data.siteID) +
        page_location +
        ip_override +
        user_agent +
        screen_resolution +
        page_referrer +
        lang +
	client_id;
  
  if (data.anonymousTracking == true) {
    requestPath += '&uia=1';
  }

  if (data.userID != '' && typeof(data.userID) != "undefined") {
    requestPath += '&uid=' + data.userID;
  }
  
  if (data.sendCustomDimensions == true) {
    const dimensionParams = parseCustomDimensions(eventData, data.customDimensionMappings);
    requestPath += dimensionParams;
  }
  
  // Add additional parameters specific to particular event types
  switch (eventType) {
    // PP: Custom / Mapped Event => Mapped events get highest priority and overrule default settings
    case 'mapped_event': {
      const eventMappings = data.eventMappings;
      let PPEventName = 'didntset';
      let PPEventAction = 'didntset';
      let PPEventCategory = 'didntset';
      let PPEventValue = 'didntset';
      let event_name = '';
      let value = '';
      eventMappings.forEach((eventmapping) => {
          // Check if event is inside the mapped events table
          if (eventData.event_name == eventmapping.gaEventName) {
             if (typeof(eventmapping.ppEventName) != "undefined") { PPEventName = eventmapping.ppEventName; }
             if (typeof(eventmapping.ppEventAction) != "undefined") { PPEventAction = eventmapping.ppEventAction; }
             if (typeof(eventmapping.ppEventCategory) != "undefined") { PPEventCategory = eventmapping.ppEventCategory; }
             if (typeof(eventmapping.ppEventValue) != "undefined") { PPEventValue = eventmapping.ppEventValue; }
          } 
      });
      if(PPEventValue != 'didntset' && PPEventValue != '') { value = '&e_v=' + encodeUriComponent(PPEventValue); } else { value = ''; }
      if(PPEventName != 'didntset' && PPEventName != '') { event_name = '&e_n=' + encodeUriComponent(PPEventName); } else { event_name = ''; }
      const event_action = PPEventAction != 'didntset' ? PPEventAction : null;
      const event_category = PPEventCategory != 'didntset' ? PPEventCategory : null;
      return requestPath + '&' +
        'e_c=' + encodeUriComponent(event_category) + '&' +
        'e_a=' + encodeUriComponent(event_action) + 
        event_name +
        value;
    }

    // PP: PageView / GA4: page_view
    case 'page_view': {
      return requestPath + '&' +
        'action_name=' + encodeUriComponent(eventData.page_title);
    }
    
    // PP: OrderCompleted / GA4: purchase
    case 'purchase': {
      const value = eventData.hasOwnProperty('value') ? encodeUriComponent(eventData.value) : 0;
      const tax = eventData.hasOwnProperty('tax') ? encodeUriComponent(eventData.tax) : 0;
      const shipping = eventData.hasOwnProperty('shipping') ? encodeUriComponent(eventData.shipping) : 0;
      const subtotal = value - shipping;
      const discount = parseDiscount(eventData.items);
      const items = parseItems(eventData.items);
      return requestPath + '&' +
        'idgoal=0' + '&' +
        'revenue=' + value + '&' +
        'ec_id=' + encodeUriComponent(eventData.transaction_id) + '&' +
        'ec_st=' + subtotal + '&' +
        'ec_tx=' + tax + '&' +
        'ec_sh=' + shipping + '&' +
        'ec_dt=' + encodeUriComponent(discount) + '&' +
        'ec_items=' + encodeUriComponent(items);
    }

    // PP: Custom / GA4: view_item
    case 'view_item': {
      const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
      const event_name = eventData.hasOwnProperty('items') ? '&e_n=' + parseItems(eventData.items) : '';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('ecommerce') + '&' +
        'e_a=' + encodeUriComponent('view_item') +
        event_name +
        value;
    }
  
    // PP: Custom / GA4: view_item_list
    case 'view_item_list': {
      const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
      const event_name = eventData.hasOwnProperty('item_list_name') ? '&e_n=' + parseItems(eventData.item_list_name) : '';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('ecommerce') + '&' +
        'e_a=' + encodeUriComponent('view_item_list') +
        event_name +
        value;
    }

    // PP: Custom / GA4: select_item
    case 'select_item': {
      const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
      const event_name = eventData.hasOwnProperty('items') ? '&e_n=' + parseItems(eventData.items) : '';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('ecommerce') + '&' +
        'e_a=' + encodeUriComponent('select_item') +
        event_name +
        value;
    }

    // PP: Custom / GA4: add_to_cart
    case 'add_to_cart': {
      const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
      const event_name = eventData.hasOwnProperty('items') ? '&e_n=' + parseItems(eventData.items) : '';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('ecommerce') + '&' +
        'e_a=' + encodeUriComponent('add_to_cart') +
        event_name +
        value;
    }

    // PP: Custom / GA4: remove_from_cart
    case 'remove_from_cart': {
      const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
      const event_name = eventData.hasOwnProperty('items') ? '&e_n=' + parseItems(eventData.items) : '';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('ecommerce') + '&' +
        'e_a=' + encodeUriComponent('remove_from_cart') +
        event_name +
        value;
    }

    // PP: Custom / GA4: begin_checkout
    case 'begin_checkout': {
      // We could update the cart at this stage but it might be unreliable so let's do a custom event. In case you want to update the cart instead then please remove the e_c, e_v, e_n, e_a parameters from this request.
      const items = eventData.hasOwnProperty('items') ? '&ec_items=' + encodeUriComponent(parseItems(eventData.items)) : '';
      const revenue = eventData.hasOwnProperty('value') ? '&revenue=' + encodeUriComponent(eventData.value) : '';
//      const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
//      const event_name = eventData.hasOwnProperty('items') ? '&e_n=' + parseItems(eventData.items) : '';
      return requestPath + '&' +
//        'e_c=' + encodeUriComponent('ecommerce') + '&' +
//        'e_a=' + encodeUriComponent('begin_checkout') +
//        event_name +
//        value + 
	'&idgoal=0' +
        items +
	revenue;
    }

    // PP: Custom / GA4: view_cart
    case 'view_cart': {
      const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
      const event_name = eventData.hasOwnProperty('items') ? '&e_n=' + parseItems(eventData.items) : '';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('ecommerce') + '&' +
        'e_a=' + encodeUriComponent('view_cart') +
        event_name +
        value;
    }

    // PP: Custom / GA4: click
    case 'click': {
      return requestPath + '&' +
        'link=' + encodeUriComponent(eventData.link_url);
    }

    // PP: Custom / GA4: file_download
    case 'file_download': {
      return requestPath + '&' +
        'download=' + encodeUriComponent(eventData.link_url);
    }

    // PP: Custom / GA4: add_payment_info
    case 'add_payment_info': {
      const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
      const payment_type = eventData.hasOwnProperty('payment_type') ? eventData.payment_type : 'Default payment method';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('add_payment_info') + '&' +
        'e_a=' + encodeUriComponent(payment_type) +
        value;
    }

    // PP: Custom / GA4: add_shipping_info
    case 'add_shipping_info': {
      const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
      const shipping_tier = eventData.hasOwnProperty('shipping_tier') ? eventData.shipping_tier : 'Default shipping method';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('add_shipping_info') + '&' +
        'e_a=' + encodeUriComponent(shipping_tier) +
        value;
    }

    // PP: Custom / GA4: login
    case 'login': {
      const method = eventData.hasOwnProperty('method') ? eventData.method : 'Default login method';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('login') + '&' +
        'e_a=' + encodeUriComponent(method);
    }

    // PP: Custom / GA4: sign_up
    case 'sign_up': {
      const method = eventData.hasOwnProperty('method') ? eventData.method : 'Default signup method';
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('sign_up') + '&' +
        'e_a=' + encodeUriComponent(method);
    }

    // PP: Custom / GA4: share
    case 'share': {
      const method = eventData.hasOwnProperty('method') ? eventData.method : 'Default share method';
      const content_type = eventData.hasOwnProperty('content_type') ? eventData.content_type : '';
      const item_id = eventData.hasOwnProperty('item_id') ? eventData.item_id : '';
      let event_name = content_type + ' ' + item_id;
      if(event_name != '') { event_name = '&e_n=' + encodeUriComponent(event_name); } else { event_name = ''; }
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('share') + '&' +
        'e_a=' + encodeUriComponent(method) +
        event_name;
    }

    // PP: Custom / GA4: user_engagement
    case 'user_engagement': {
      const engagement_time_msec = eventData.hasOwnProperty('engagement_time_msec') ? Math.round(eventData.engagement_time_msec / 1000) + ' seconds' : null;
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('user_engagement') + '&' +
        'e_a=' + encodeUriComponent(engagement_time_msec);
    }
    
    // PP: Custom / GA4: scroll
    case 'scroll': {
      const percent_scrolled = eventData.hasOwnProperty('percent_scrolled') ? eventData.percent_scrolled + '%' : null;
      return requestPath + '&' +
        'e_c=' + encodeUriComponent('scroll') + '&' +
        'e_a=' + encodeUriComponent(percent_scrolled);
    }
    
    // PP: Custom / GA4: [anything else]
    case eventData.event_name: {
        const value = eventData.hasOwnProperty('value') ? '&e_v=' + encodeUriComponent(eventData.value) : '';
        const event_name = eventData.hasOwnProperty('event_name') ? eventData.event_name : null;
        return requestPath + '&' +
          'e_c=' + encodeUriComponent('ga4_events') + '&' +
          'e_a=' + encodeUriComponent(event_name) + 
          value;
    }
  }
};

// Process event data and build a request path
const requestPath = buildRequest(eventData);

// Build the full URL for sending the request
const url = data.accountURL + requestPath;

// The sendHttpGet API takes a URL and a result callback. You must call
// data.gtmOnSuccess() or data.gtmOnFailure() so that the container knows when
// the tag has finished executing.
sendHttpGet(url, (statusCode) => {
  if (statusCode >= 200 && statusCode < 300) {
    data.gtmOnSuccess();
  } else {
    data.gtmOnFailure();
  }
});


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 26/08/2022, 01:28:30


